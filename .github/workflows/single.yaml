---
    name: check single url
    
    on:
      workflow_dispatch:
        inputs:
          url:
            description: 'url to test'
            required: true
            default: 'https://www.sonarqube-dev.ucl.ac.uk'
            type: string
    
    jobs:
      check_url:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v5
          - uses: actions/checkout@v5
            with:
              repository: 'the-markup/blacklight-query'
              path: scanner/blacklight-query
          - uses: actions/setup-node@v4
            with:
              node-version: '20.15.1'
          - name: node
            working-directory: scanner/blacklight-query
            run: npm install
        #   - name: setup lib
        #     run: |
        #       #ldd chrome | grep not
        #       sudo apt-get install -y libatk-bridge2.0-0
        #       sudo apt-get install -y ca-certificates fonts-liberation libasound2 libatk-bridge2.0-0 \
        #         libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 \
        #         libglib2.0-0 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 \
        #         libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 \
        #         libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils
    
          - name: run backlight
            env:
              URL: ${{ github.event.inputs.url }}
            working-directory: "scanner/blacklight-query"
            run: |
              echo "Checking url $URL"
              node --version
              echo "${URL}" | ./blacklight-query
          - name: job summary
            env:
              URL: ${{ github.event.inputs.url }}
            working-directory: "scanner/blacklight-query"
            run: |
              ls -l output*
              DOMAINS=$(cat outputs/*/inspection.json | jq -r .hosts)
              cat outputs/*/inspection.json | jq -r .hosts
              #COOKIES=$(cat outputs/*/inspection.json | jq -r .reports.cookies)
              echo "### ${URL}" >> $GITHUB_STEP_SUMMARY
              echo "Domains:\n\`\`\`${DOMAINS}\`\`\`" >> $GITHUB_STEP_SUMMARY
              #echo "Cookies:\n\`\`\`${COOKIES}\`\`\`" >> $GITHUB_STEP_SUMMARY
